# é‡Œç¨‹ç¢‘ä¸è¯¦ç»†éœ€æ±‚

æœ¬æ–‡æ¡£å®šä¹‰å„é‡Œç¨‹ç¢‘åŠæ¯ä¸ªé‡Œç¨‹ç¢‘çš„è¯¦ç»†éœ€æ±‚å†…å®¹ã€‚ä¸ `PRD.md` ä¸€è‡´ï¼Œéœ€æ±‚å˜æ›´ä»¥ PRD ä¸ºå‡†ã€‚

---

## æ€»è§ˆ

```mermaid
flowchart LR
  M1[M1 æ•°æ®é—­ç¯] --> M2[M2 å®Œæ•´ UI]
  M2 --> M3[M3 å¯äº¤ä»˜]
  M3 --> M4[M4 åŒæ­¥ä¸æ”¹è¿›]
  M4 --> M5[M5 å›½é™…åŒ–]
  M5 --> M6[M6 å¯Œæ–‡æœ¬è¯„è®º]
  M6 --> DONE[å½“å‰ç‰ˆæœ¬å®Œæˆ]
  DONE --> M7[M7 åŒæ­¥å¢å¼º VNext]
```

| é‡Œç¨‹ç¢‘ | ç›®æ ‡ | çŠ¶æ€ |
|--------|------|------|
| **M1** | æ•°æ®é—­ç¯ï¼šè¿ç§» + æ ¸å¿ƒå‘½ä»¤ + æœ€ç®€éªŒè¯ UI | âœ… å·²å®Œæˆ |
| **M2** | å®Œæ•´ UIï¼šé¡µé¢ã€ç­›é€‰ã€è§„åˆ™æ ¡éªŒã€æˆå‘˜/Partner è§†å›¾ | âœ… å·²å®Œæˆ |
| **M3** | å¯äº¤ä»˜ï¼šå¯¼å‡ºã€æ‰“åŒ…ã€é”™è¯¯ä¸ç©ºçŠ¶æ€ä½“éªŒ | âœ… å·²å®Œæˆ |
| **M4** | åŒæ­¥ä¸æ”¹è¿›ï¼šS3 å¤šè®¾å¤‡åŒæ­¥é—­ç¯ + å¯¼å…¥ + æ ‡ç­¾ç­›é€‰ + Zustand | âœ… å·²å®Œæˆï¼ˆæ–¹æ¡ˆAæ”¶å°¾ï¼‰ |
| **M5** | å›½é™…åŒ–ï¼ši18n æ¡†æ¶ + è‹±æ–‡/ä¸­æ–‡ç¿»è¯‘ + è¯­è¨€åˆ‡æ¢ | âœ… å·²å®Œæˆ |
| **M6** | å¯Œæ–‡æœ¬è¯„è®ºï¼šTiptap ç¼–è¾‘å™¨ + CRUD + ç½®é¡¶ + å…³è”æ“ä½œäºº + S3 åŒæ­¥ | âœ… å·²å®Œæˆ |
| **M7** | åŒæ­¥å¢å¼ºï¼ˆP1-P4ï¼‰ï¼šå®‰å…¨/å¯é æ€§/å¯è§‚æµ‹æ€§/æ€§èƒ½ | ğŸš§ è§„åˆ’ä¸­ |

---

## M1ï¼šæ•°æ®é—­ç¯ï¼ˆå·²å®Œæˆï¼‰

**ç›®æ ‡**ï¼šåç«¯ä¸ DB æ‰“é€šï¼Œæ ¸å¿ƒå†™è¯»ä¸çŠ¶æ€å˜æ›´å¯éªŒè¯ï¼Œæ— æ­»é”ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 1.1 å·¥ç¨‹ä¸æ•°æ®
- [x] Tauri + Vite + React + TypeScript è„šæ‰‹æ¶
- [x] Mantine æ¥å…¥ï¼ˆåŸºç¡€ Providerï¼‰
- [x] SQLite è¿ç§»ï¼š`schema_migrations` + `0001_init.sql`ï¼ˆpersons, partners, projects, assignments, status_history, project_tagsï¼‰
- [x] å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º DB å¹¶æ‰§è¡Œè¿ç§»ï¼Œè·¯å¾„ï¼š`~/Library/Application Support/com.tauri.dev/app.db`

#### 1.2 é¢†åŸŸä¸ç”¨ä¾‹
- [x] Domainï¼š`ProjectStatus` æšä¸¾ + `StatusMachine::can_transition` / `note_required`
- [x] Appï¼š`project_create`ï¼ˆäº‹åŠ¡å†…ï¼šinsert project + owner assignment + åˆå§‹ status_history + tagsï¼‰
- [x] Appï¼š`project_get`ã€`project_list`ã€`project_change_status`ï¼ˆäº‹åŠ¡å†…ï¼šhistory + æ›´æ–° current_statusï¼Œ**é‡Šæ”¾è¿æ¥åå†è°ƒ project_getï¼Œé¿å…æ­»é”**ï¼‰
- [x] Appï¼š`partner_create`ã€`partner_list`ï¼›`person_create`ã€`person_list`
- [x] é”™è¯¯æ¨¡å‹ï¼š`AppError` + ç¨³å®š `code`ï¼ˆå« `From<rusqlite::Error>`ï¼‰

#### 1.3 å‘½ä»¤å±‚
- [x] Commandsï¼š`cmd_partner_create/list`ã€`cmd_person_create/list`ã€`cmd_project_create/get/list`ã€`cmd_project_change_status`
- [x] DTO ä¸å‰ç«¯çº¦å®šï¼šè¯·æ±‚ä½“ä½¿ç”¨ **camelCase**ï¼ˆä¸ Rust `#[serde(rename_all = "camelCase")]` ä¸€è‡´ï¼‰

#### 1.4 æœ€ç®€éªŒè¯ UI
- [x] å•é¡µï¼šåˆ›å»º Partner/Personã€åˆ›å»º Projectï¼ˆå¿…é€‰ partner/owner/countryï¼‰ã€åˆ—è¡¨ã€çŠ¶æ€å˜æ›´æŒ‰é’®
- [x] è°ƒç”¨ `invoke` å°è£…ï¼ˆ`src/api/invoke.ts`ï¼‰ï¼Œé”™è¯¯åœ¨é¡µé¢ log åŒºå±•ç¤º

#### 1.5 éªŒæ”¶
- [x] åˆ›å»ºé¡¹ç›®åçŠ¶æ€ä¸º BACKLOGï¼Œæ—¶é—´çº¿è‡³å°‘ 1 æ¡
- [x] çŠ¶æ€å˜æ›´ä¸å¡æ­»ï¼Œè¿”å›æœ€æ–°é¡¹ç›®è¯¦æƒ…
- [x] æ¸…ç©º DB åé‡å¯ï¼Œè¿ç§»é‡æ–°æ‰§è¡Œæ— æŠ¥é”™

---

## M2ï¼šå®Œæ•´ UI ä¸è§„åˆ™

**ç›®æ ‡**ï¼šæŒ‰ PRD å®Œæˆæ‰€æœ‰ MVP é¡µé¢ä¸äº¤äº’ï¼Œè§„åˆ™ä¸ä¸å˜é‡åœ¨å‰åç«¯ä¸€è‡´è½åœ°ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 2.1 è·¯ç”±ä¸é¡µé¢ç»“æ„
- [x] è·¯ç”±ï¼šProjectsï¼ˆåˆ—è¡¨ + è¯¦æƒ…ï¼‰ã€Peopleï¼ˆåˆ—è¡¨ + è¯¦æƒ…ï¼‰ã€Partnersï¼ˆåˆ—è¡¨ + è¯¦æƒ…ï¼‰ã€Settingsï¼ˆå¯¼å‡ºå…¥å£ï¼‰
- [x] å¯¼èˆªï¼šé¡¶éƒ¨æˆ–ä¾§è¾¹å¯¼èˆªï¼Œå½“å‰é¡µé«˜äº®

#### 2.2 é¡¹ç›®ï¼ˆProjectsï¼‰
- [x] **åˆ—è¡¨é¡µ**
  - è¡¨æ ¼/å¡ç‰‡ï¼šåç§°ã€çŠ¶æ€ã€å›½å®¶ã€Partnerã€è´Ÿè´£äººã€æˆªæ­¢æ—¥ã€æ›´æ–°æ—¶é—´ã€æ ‡ç­¾
  - ç­›é€‰ï¼šçŠ¶æ€ã€å›½å®¶ã€Partnerã€è´Ÿè´£äººã€å‚ä¸æˆå‘˜ã€ä»…æœªå½’æ¡£ï¼ˆé»˜è®¤ onï¼‰
  - æ’åºï¼šæ›´æ–°æ—¶é—´ï¼ˆé»˜è®¤ï¼‰ã€ä¼˜å…ˆçº§ã€æˆªæ­¢æ—¥
  - æ“ä½œï¼šæ–°å»ºã€è¿›å…¥è¯¦æƒ…ã€å¯é€‰â€œå¿«é€Ÿæ”¹çŠ¶æ€â€
- [x] **æ–°å»º/ç¼–è¾‘é¡¹ç›®**
  - è¡¨å•ï¼šåç§°ï¼ˆå¿…å¡«ï¼‰ã€æè¿°ã€ä¼˜å…ˆçº§ã€å›½å®¶ï¼ˆå¿…å¡«ï¼‰ã€Partnerï¼ˆå¿…å¡«ï¼Œä¸‹æ‹‰+æœç´¢ï¼Œåˆ›å»ºåä¸å¯æ”¹ï¼‰ã€è´Ÿè´£äººï¼ˆå¿…å¡«ï¼Œä¸‹æ‹‰+æœç´¢ï¼‰
  - å¯é€‰ï¼šå¼€å§‹/æˆªæ­¢æ—¥æœŸã€æ ‡ç­¾
  - æ ¡éªŒï¼šå‰ç«¯ zod é¢„æ ¡éªŒï¼›åç«¯ `project_update` **ç¦æ­¢** `partnerId`ï¼ˆè‹¥ä¼ åˆ™ `PARTNER_IMMUTABLE`ï¼‰
- [x] **é¡¹ç›®è¯¦æƒ…**
  - æ¦‚è§ˆï¼šåŸºç¡€ä¿¡æ¯ã€å½“å‰çŠ¶æ€ã€å›½å®¶ã€Partnerï¼ˆåªè¯»ï¼‰ã€è´Ÿè´£äººï¼ˆå¯æ”¹ï¼Œä¸”ä¿è¯ owner ä¸ºå½“å‰æˆå‘˜ï¼‰
  - æˆå‘˜åŒºï¼šå½“å‰å‚ä¸åˆ—è¡¨ï¼ˆå§“åã€è§’è‰²ã€èµ·æ­¢æ—¶é—´ï¼‰ï¼Œæ“ä½œâ€œåŠ å…¥æˆå‘˜â€â€œé€€å‡ºâ€
  - çŠ¶æ€æ—¶é—´çº¿ï¼šå€’åºå±•ç¤ºï¼ˆæ—¶é—´ã€fromâ†’toã€æ“ä½œäººã€å¤‡æ³¨ï¼‰
  - çŠ¶æ€å˜æ›´ï¼šä»…å±•ç¤ºå…è®¸çš„ä¸‹ä¸€çŠ¶æ€ï¼›ç‰¹æ®Šè·¯å¾„ï¼ˆè¿”å·¥/å–æ¶ˆå½’æ¡£/æ”¾å¼ƒï¼‰å¼¹çª—å¼ºåˆ¶å¡«å¤‡æ³¨

#### 2.3 æˆå‘˜ï¼ˆPeopleï¼‰
- [x] **åˆ—è¡¨é¡µ**ï¼šå§“åã€æ˜¯å¦å¯ç”¨ã€å½“å‰é¡¹ç›®æ•°ï¼ˆå¯é€‰ï¼‰
- [x] **æ–°å»º/ç¼–è¾‘**ï¼šå§“åï¼ˆå¿…å¡«ï¼‰ã€å¤‡æ³¨ï¼›æ”¯æŒåœç”¨ï¼ˆä¸åˆ ï¼‰
- [x] **æˆå‘˜è¯¦æƒ…**
  - **å½“å‰é¡¹ç›®**ï¼š`assignments.end_at IS NULL` ä¸”é¡¹ç›®æœªå½’æ¡£
  - **åšè¿‡çš„é¡¹ç›®**ï¼šå­˜åœ¨ä»»æ„ assignment çš„é¡¹ç›®ï¼ˆå»é‡ï¼ŒæŒ‰æœ€è¿‘å‚ä¸æ—¶é—´æ’åºï¼‰

#### 2.4 Partnerï¼ˆåˆä½œæ–¹ï¼‰
- [x] **åˆ—è¡¨é¡µ**ï¼šåç§°ã€æ˜¯å¦å¯ç”¨ã€å…³è”é¡¹ç›®æ•°ï¼ˆå¯é€‰ï¼‰
- [x] **æ–°å»º/ç¼–è¾‘**ï¼šåç§°ï¼ˆå¿…å¡«ã€å”¯ä¸€ï¼‰ã€å¤‡æ³¨ï¼›æ”¯æŒåœç”¨ï¼ˆåœç”¨åä¸å¯è¢«æ–°é¡¹ç›®é€‰ï¼‰
- [x] **Partner è¯¦æƒ…**ï¼ˆå¯é€‰ï¼‰ï¼šå…³è”é¡¹ç›®åˆ—è¡¨

#### 2.5 å›½å®¶ä¸æ•°æ®
- [x] å›½å®¶ï¼šé¡¹ç›®è¡¨å•ä¸ºå›½å®¶ä¸‹æ‹‰ï¼Œå€¼åŸŸ ISO 3166-1 alpha-2ï¼Œå»ºè®®å†…ç½®é™æ€åˆ—è¡¨ï¼ˆå¦‚ CN/US/JPâ€¦ï¼‰
- [x] åˆ—è¡¨ç­›é€‰ä¸ PRD ç¬¬ 7 ç« ä¸€è‡´ï¼ˆçŠ¶æ€ã€å›½å®¶ã€Partnerã€è´Ÿè´£äººã€å‚ä¸æˆå‘˜ã€æ ‡ç­¾ï¼‰

#### 2.6 åç«¯è¡¥å…¨ï¼ˆè‹¥ M1 æœªåšï¼‰
- [x] `project_update`ï¼šå¯ç¼–è¾‘ name/description/priority/country/owner/startDate/dueDate/tagsï¼›**ç¦æ­¢** `partnerId`ï¼Œå¦åˆ™è¿”å› `PARTNER_IMMUTABLE`
- [x] `assignment_add_member`ã€`assignment_end_member`ã€`assignment_list_by_project`
- [x] `person_get`ã€`person_update`ã€`person_deactivate`ï¼›`person_current_projects`ã€`person_all_projects`
- [x] `partner_get`ã€`partner_update`ã€`partner_deactivate`ã€`partner_projects`
- [x] è®¾ç½®/æ›´æ¢ Owner æ—¶ï¼šè‹¥æ–° owner æ— å½“å‰å‚ä¸è®°å½•ï¼Œäº‹åŠ¡å†…è‡ªåŠ¨åˆ›å»º assignment

#### 2.7 éªŒæ”¶
- [x] é¡¹ç›®åˆ›å»º/ç¼–è¾‘/è¯¦æƒ…/çŠ¶æ€å˜æ›´å…¨æµç¨‹å¯èµ°é€šï¼ŒPartner åˆ›å»ºåä¸å¯æ”¹
- [x] æˆå‘˜è¯¦æƒ…â€œå½“å‰é¡¹ç›®â€ä¸â€œåšè¿‡çš„é¡¹ç›®â€ä¸ PRD ç¬¬ 3 ç« å£å¾„ä¸€è‡´
- [x] ç‰¹æ®ŠçŠ¶æ€å˜æ›´ï¼ˆè¿”å·¥ã€å–æ¶ˆå½’æ¡£ã€æ”¾å¼ƒï¼‰å¿…é¡»å¡«å¤‡æ³¨

---

## M3ï¼šå¯äº¤ä»˜ âœ… å·²å®Œæˆ

**ç›®æ ‡**ï¼šå¯æ‰“åŒ…åˆ†å‘ã€æ•°æ®å¯å¤‡ä»½ã€é”™è¯¯ä¸ç©ºçŠ¶æ€ä½“éªŒå®Œæ•´ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 3.1 å¯¼å‡º/å¤‡ä»½
- [x] å‘½ä»¤ï¼š`export_json_string`ï¼ˆæˆ–ç­‰ä»·ï¼‰ï¼Œè¿”å›ç¬¦åˆ PRD å¯¼å‡º schema çš„ JSON å­—ç¬¦ä¸²ï¼ˆå« metaã€personsã€partnersã€projectsã€assignmentsã€statusHistoryã€tagsï¼‰
- [x] å‰ç«¯ï¼šSettings æˆ–ç‹¬ç«‹â€œå¯¼å‡ºâ€å…¥å£ï¼Œè§¦å‘å¯¼å‡ºåé€šè¿‡â€œå¦å­˜ä¸ºâ€å¯¹è¯æ¡†å†™æ–‡ä»¶ï¼ˆè·¯å¾„ç”±ç”¨æˆ·é€‰æ‹©ï¼‰

#### 3.2 æ‰“åŒ…ä¸è¿è¡Œç¯å¢ƒ
- [x] `cargo tauri build` æˆåŠŸï¼Œäº§å‡º macOS .appï¼ˆæˆ–å½“å‰ç›®æ ‡å¹³å°ï¼‰
- [x] é¦–æ¬¡è¿è¡Œè‡ªåŠ¨åˆ›å»ºåº”ç”¨æ•°æ®ç›®å½•ä¸ DBï¼Œè¿ç§»æ­£å¸¸æ‰§è¡Œ
- [x] å…³é—­åº”ç”¨åå†æ¬¡æ‰“å¼€ï¼Œæ•°æ®æŒä¹…å­˜åœ¨

#### 3.3 ä½“éªŒä¸å¥å£®æ€§
- [x] é”™è¯¯æç¤ºï¼šæ¥å£è¿”å› `AppError` æ—¶ï¼Œå‰ç«¯ç»Ÿä¸€è§£æ `code`/`message`ï¼Œç”¨ Mantine é€šçŸ¥æˆ–å†…è”æç¤ºå±•ç¤ºï¼Œé¿å…ç™½å±æˆ–é™é»˜å¤±è´¥
- [x] ç©ºçŠ¶æ€ï¼šåˆ—è¡¨æ— æ•°æ®ã€æˆå‘˜æ— é¡¹ç›®ã€Partner æ— é¡¹ç›®æ—¶ï¼Œæœ‰æ˜ç¡®æ–‡æ¡ˆä¸å¼•å¯¼ï¼ˆå¦‚â€œå…ˆå»åˆ›å»º Partner / é¡¹ç›®â€ï¼‰
- [x] å…³é”®æ“ä½œç¡®è®¤ï¼ˆå¯é€‰ï¼‰ï¼šå½’æ¡£ã€å–æ¶ˆå½’æ¡£ã€åˆ é™¤/åœç”¨å‰å¯äºŒæ¬¡ç¡®è®¤

#### 3.4 æ–‡æ¡£ä¸äº¤ä»˜ç‰©
- [x] READMEï¼šè¿è¡Œè¦æ±‚ï¼ˆNodeã€Rustï¼‰ã€`npm install` + `npm run tauri dev` / `npm run tauri build`
- [x] å¯é€‰ï¼šç®€çŸ­â€œä½¿ç”¨è¯´æ˜â€ï¼ˆå¦‚ä½•åˆ›å»ºé¡¹ç›®ã€æ”¹çŠ¶æ€ã€çœ‹æˆå‘˜è§†å›¾ã€å¯¼å‡ºå¤‡ä»½ï¼‰

#### 3.5 éªŒæ”¶
- [x] å¯¼å‡ºæ–‡ä»¶å¯æ‰“å¼€ä¸”ç»“æ„ç¬¦åˆ PRD å¯¼å‡º schema
- [x] æ‰“åŒ…åçš„åº”ç”¨å¯ç‹¬ç«‹è¿è¡Œï¼Œæ•°æ®ç›®å½•ä¸ DB è¡Œä¸ºæ­£ç¡®
- [x] å¸¸è§é”™è¯¯ï¼ˆå¦‚å¿…å¡«ä¸ºç©ºã€éæ³•çŠ¶æ€è·ƒè¿ã€note æœªå¡«ï¼‰æœ‰æ˜ç¡®æç¤º

---

## M4ï¼šåŒæ­¥ä¸æ”¹è¿› âœ… å·²å®Œæˆ

**ç›®æ ‡**ï¼šå½¢æˆå¯ç”¨ä¸”ç¨³å®šçš„åŒæ­¥é—­ç¯ï¼ˆä¸Šä¼ /æ‹‰å–/æ ¡éªŒ/åº”ç”¨/é˜²å›æµï¼‰ï¼Œå¹¶å®Œæˆå¯¼å…¥ã€æ ‡ç­¾ç­›é€‰ã€Zustand ç®¡ç†ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 4.1 S3 å¤šè®¾å¤‡åŒæ­¥
- [x] è¿ç§» `0003_add_sync_support.sql`ï¼šæ–°å¢ `sync_metadata`ã€`vector_clocks`ã€`sync_config` è¡¨åŠå˜æ›´è§¦å‘å™¨
- [x] `cmd_sync_full` å®Œæ•´é“¾è·¯ï¼šä¸Šä¼ æœ¬åœ° Delta -> ä¸‹è½½è¿œç«¯ Delta -> æ ¡éªŒ -> äº‹åŠ¡åº”ç”¨
- [x] è¿œç«¯ Delta è¿‡æ»¤ç­–ç•¥ï¼šæ’é™¤æœ¬æœºå¯¹è±¡ï¼ŒæŒ‰ `source_device_id + timestamp + key` æ’åºååº”ç”¨
- [x] æ¯è®¾å¤‡æ¶ˆè´¹æ¸¸æ ‡ï¼š`last_remote_delta_ts::<source_device_id>`ï¼ˆå­˜å‚¨äº `sync_config`ï¼‰
- [x] é˜²å›æµï¼ˆanti-reuploadï¼‰ï¼š`mark_remote_applied_operations_synced` æ ‡è®°è§¦å‘å™¨å›å†™è¡Œä¸ºä¸ºå·²åŒæ­¥
- [x] å†²çªç­–ç•¥ï¼šä¿ç•™ `VectorClock` å†²çªæ£€æµ‹å…¥å£ + æœ€å° LWW ä¿æŠ¤ï¼ˆ`remote_version < local_version` è·³è¿‡ï¼‰
- [x] `DeltaSyncEngine`ï¼šæ”¯æŒ `project_tags` å¤åˆé”®åˆ é™¤ä¸ `project_comments` upsert/delete
- [x] Bootstrap è¡Œä¸ºï¼šè¿œç«¯ç©ºæ¡¶æ—¶è‡ªåŠ¨ä¸Šä¼ åˆå§‹ snapshotï¼Œé¿å…â€œåŒæ­¥æˆåŠŸä½†è¿œç«¯ç©ºæ•°æ®â€
- [x] `SnapshotManager`ï¼šå…¨é‡å¿«ç…§åˆ›å»º/æ¢å¤/ä¸Šä¼ /ä¸‹è½½ï¼Œæ”¯æŒ checksum æ ¡éªŒä¸ gzip å‹ç¼©ï¼Œæ¢å¤é“¾è·¯è¦†ç›– comments
- [x] `S3SyncClient`ï¼šå…¼å®¹ AWS S3 / Cloudflare R2 / MinIOï¼Œæ”¯æŒè‡ªå®šä¹‰ endpoint
- [x] å‘½ä»¤å±‚è¡¥å…¨ï¼š`sync_get/update/set_enabled/reveal_secret_key/test_connection/get_status/full/create_snapshot/restore_snapshot`
- [x] å‰ç«¯ `SyncManager` + `SyncStatusBar` + Settings åŒæ­¥é…ç½®åŒºå—è”åŠ¨

#### 4.2 æ•°æ®å¯¼å…¥
- [x] åç«¯ `import_json_string`ï¼šè§£æ JSONï¼ŒæŒ‰ FK ä¾èµ–é¡ºåºå†™å…¥ï¼ˆpersons â†’ partners â†’ projects+tags â†’ assignments â†’ status_historyï¼‰
- [x] `INSERT OR IGNORE` å¹‚ç­‰å¯¼å…¥ï¼Œé‡å¤ ID è‡ªåŠ¨è·³è¿‡
- [x] Schema ç‰ˆæœ¬å…¼å®¹ï¼ˆversion=1 ä¸ version=2ï¼‰
- [x] è¿”å› `ImportResult`ï¼ˆå„ç±»å‹å¯¼å…¥æ•°é‡ + è·³è¿‡æ•°é‡ï¼‰
- [x] å‰ç«¯ Settings é¡µ"å¯¼å…¥æ•°æ®"æŒ‰é’®ï¼Œé€‰æ‹© .json æ–‡ä»¶åè°ƒç”¨åç«¯å¯¼å…¥
- [x] 5 ä¸ª import é›†æˆæµ‹è¯•ï¼ˆç©ºåº“å¯¼å…¥ã€é‡å¤è·³è¿‡ã€æ— æ•ˆ JSONã€é”™è¯¯ç‰ˆæœ¬ã€å¾€è¿”ä¸€è‡´æ€§ï¼‰

#### 4.3 é¡¹ç›®åˆ—è¡¨å¢å¼º
- [x] åç«¯ `project_list` æ”¯æŒ 6 ç§ç­›é€‰æ¡ä»¶ï¼ˆstatuses/countryCodes/partnerIds/ownerPersonIds/participantPersonIds/tagsï¼‰
- [x] æ’åºå‚æ•°æ”¯æŒï¼ˆsort_by: updatedAt/priority/dueDate, sort_order: asc/descï¼‰
- [x] è¿”å› `Page<T>` ç»“æ„ï¼ˆå« total/limit/offsetï¼‰
- [x] å‰ç«¯æ ‡ç­¾å¤šé€‰ç­›é€‰ï¼ˆ`MultiSelect` ç»„ä»¶ï¼‰ï¼Œä»å·²æœ‰é¡¹ç›®è‡ªåŠ¨æ”¶é›†æ ‡ç­¾
- [x] å‰ç«¯åˆ†é¡µ UIï¼ˆ`Pagination` ç»„ä»¶ï¼‰

#### 4.4 Zustand å…¨å±€çŠ¶æ€ç®¡ç†
- [x] `usePartnerStore`ï¼šåˆä½œæ–¹åˆ—è¡¨ç¼“å­˜ + `activeOptions()`
- [x] `usePersonStore`ï¼šæˆå‘˜åˆ—è¡¨ç¼“å­˜ + `activeOptions()`
- [x] `useTagStore`ï¼šå…¨å±€æ ‡ç­¾ç¼“å­˜
- [x] æ‰€æœ‰è¡¨å•é¡µï¼ˆProjectForm/PersonForm/PartnerFormï¼‰åœ¨ CRUD åè‡ªåŠ¨ invalidate ç›¸å…³ store
- [x] Settings å¯¼å…¥æ•°æ®å invalidate æ‰€æœ‰ store

#### 4.5 å…¶ä»–æ”¹è¿›
- [x] æ–°å¢ `assignment_list_by_project` å‘½ä»¤
- [x] `ConfirmModal` ç»Ÿä¸€ç¡®è®¤å¼¹çª—ç»„ä»¶
- [x] é‡å‘½å `export.rs` â†’ `data_transfer.rs`ï¼ˆåæ˜ å¯¼å…¥å¯¼å‡ºåŒå‘èŒè´£ï¼‰
- [x] è‡ªåŠ¨åŒæ­¥è°ƒåº¦è¿ç§»åˆ° Rust åç«¯ schedulerï¼ˆå‰ç«¯ä¸æŒæœ‰ä¸»å®šæ—¶å™¨ï¼‰
- [x] `sync_lock + is_syncing` å¹¶å‘æ§åˆ¶ï¼Œé¿å…æ‰‹åŠ¨åŒæ­¥ä¸å®šæ—¶åŒæ­¥å¹¶å‘æ‰§è¡Œ

#### 4.6 æµ‹è¯•è¦†ç›–
- [x] åç«¯å…¨é‡æµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›– sync/snapshot/conflict/trigger ç­‰å…³é”®è·¯å¾„ï¼‰
- [x] è¡¥å……åŒæ­¥å…³é”®æµ‹è¯•ï¼š
  - `apply_delta_upsert_project_tags`
  - `apply_delta_upsert_project_comments`
  - `apply_delta_delete_project_tag_by_composite_record_id`
  - `apply_delta_upsert_person_stale_version_is_ignored`
  - `mark_remote_applied_operations_synced_marks_trigger_rows`
  - `restore_snapshot_full_flow`
  - `restore_snapshot_clears_all_tables`

#### 4.7 éªŒæ”¶
- [x] å¯¼å‡º â†’ å¯¼å…¥å¾€è¿”æ•°æ®ä¸€è‡´
- [x] æ ‡ç­¾ç­›é€‰å¯ç»„åˆä½¿ç”¨ï¼Œä¸åç«¯ SQL `IN` æŸ¥è¯¢è”åŠ¨
- [x] è¡¨å•é¡µä¸‹æ‹‰é€‰é¡¹ä» Zustand store è·å–ï¼Œé¿å…é‡å¤ API è¯·æ±‚
- [x] S3 åŒæ­¥é…ç½®å¯ä¿å­˜ï¼Œè¿æ¥æµ‹è¯•å¯æ‰§è¡Œï¼Œå¯åœçŠ¶æ€å¯æŒä¹…åŒ–
- [x] è¿œç«¯ Delta å¯è½åº“ä¸”ä¸ä¼šå›æµé‡ä¼ ï¼ˆé˜² ping-pongï¼‰
- [x] `project_tags` / `project_comments` å¯åœ¨å¤šè®¾å¤‡é—´åŒæ­¥
- [x] snapshot restore å comments æ•°æ®å®Œæ•´å¯ç”¨

#### 4.8 æ–¹æ¡ˆAæ”¶å°¾çŠ¶æ€ï¼ˆ2026-02ï¼‰

| èƒ½åŠ› | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| æœ¬åœ° Delta é‡‡é›†/ä¸Šä¼  | âœ… | å·²å®Œæˆ |
| è¿œç«¯ Delta ä¸‹è½½/åº”ç”¨ | âœ… | å·²å®Œæˆ |
| checksum æ ¡éªŒ | âœ… | å·²å®Œæˆ |
| `project_tags` / `project_comments` Delta æ”¯æŒ | âœ… | å·²å®Œæˆ |
| é˜²å›æµï¼ˆanti-reuploadï¼‰ | âœ… | å·²å®Œæˆ |
| æœ€å° LWW ä¿æŠ¤ | âœ… | å·²å®Œæˆ |
| ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆE2Eï¼‰ | ğŸš§ | è§„åˆ’ä¸­ |
| å¿«ç…§è½®è½¬æ¸…ç† | ğŸš§ | è§„åˆ’ä¸­ |

---

## M5ï¼šå›½é™…åŒ–ï¼ˆi18nï¼‰ âœ… å·²å®Œæˆ

**ç›®æ ‡**ï¼šæ”¯æŒä¸­è‹±æ–‡åŒè¯­ UIï¼Œå¯è¿è¡Œæ—¶åˆ‡æ¢è¯­è¨€ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 5.1 i18n æ¡†æ¶æ­å»º
- [x] æ¥å…¥ `i18next` + `react-i18next`
- [x] åˆ›å»º `src/i18n.ts` åˆå§‹åŒ–é…ç½®ï¼ˆé»˜è®¤ enï¼Œfallback enï¼‰
- [x] åˆ›å»º `src/locales/en.json` å’Œ `src/locales/zh.json` ç¿»è¯‘æ–‡ä»¶ï¼ˆçº¦ 250 ä¸ª keyï¼‰
- [x] `main.tsx` ä¸­å¯¼å…¥ i18n åˆå§‹åŒ–æ–‡ä»¶

#### 5.2 å…¨é‡å­—ç¬¦ä¸²å›½é™…åŒ–
- [x] æ‰€æœ‰ 16 ä¸ªå‰ç«¯æ–‡ä»¶ï¼ˆ11 é¡µé¢ + 2 å…±äº«ç»„ä»¶ + 3 å·¥å…·/å¸¸é‡ï¼‰å®Œæˆ i18n æ”¹é€ 
- [x] æ‰€æœ‰ç¡¬ç¼–ç ä¸­æ–‡å­—ç¬¦ä¸²æ›¿æ¢ä¸º `t()` è°ƒç”¨
- [x] åŠ¨æ€å†…å®¹ä½¿ç”¨æ’å€¼ï¼ˆå¦‚ `t('project.list.total', { count })`ï¼‰
- [x] é¡¹ç›®çŠ¶æ€ç¿»è¯‘ï¼š`getStatusLabel(status, t)` åŸºäº `status.*` key
- [x] å›½å®¶åç§°ç¿»è¯‘ï¼š`getCountries(lng)` åŸºäº `i18n-iso-countries` åŠ¨æ€ locale
- [x] è§’è‰²æ ‡ç­¾ç¿»è¯‘ï¼š`PERSON_ROLES.label` å­˜å‚¨ i18n keyï¼Œ`getRoleLabel()` é€šè¿‡ `i18n.t()` è§£æ

#### 5.3 è¯­è¨€åˆ‡æ¢
- [x] Settings é¡µé¢æ–°å¢è¯­è¨€åˆ‡æ¢åŒºåŸŸï¼ˆ`SegmentedControl`ï¼šEnglish / ä¸­æ–‡ï¼‰
- [x] åˆ‡æ¢æ—¶è°ƒç”¨ `i18n.changeLanguage(lng)` å³æ—¶ç”Ÿæ•ˆï¼ˆæ— éœ€åˆ·æ–°ï¼‰
- [x] `dayjs` locale åŒæ­¥åˆ‡æ¢ï¼ˆen/zh-cnï¼‰
- [x] `i18n-iso-countries` å›½å®¶åç§°éšè¯­è¨€åˆ‡æ¢

#### 5.4 éªŒæ”¶
- [x] é»˜è®¤è‹±æ–‡ç•Œé¢ï¼Œæ‰€æœ‰é¡µé¢æ— æ®‹ç•™ä¸­æ–‡ç¡¬ç¼–ç 
- [x] åˆ‡æ¢ä¸­æ–‡åæ‰€æœ‰é¡µé¢æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡
- [x] `npm run build` ç¼–è¯‘æ— é”™è¯¯

---

## M6ï¼šå¯Œæ–‡æœ¬è¯„è®º âœ… å·²å®Œæˆ

**ç›®æ ‡**ï¼šä¸ºé¡¹ç›®æ·»åŠ å¯Œæ–‡æœ¬è¯„è®ºåŠŸèƒ½ï¼Œæ”¯æŒæ ¼å¼åŒ–æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼ã€ä»»åŠ¡æ¸…å•ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 6.1 æ•°æ®åº“ & åŒæ­¥
- [x] Migration `0004_add_project_comments.sql`ï¼ˆè¡¨ + ç´¢å¼• + åŒæ­¥è§¦å‘å™¨ï¼‰
- [x] `project_comments` è¡¨ï¼šid, project_id, person_id, content (JSON), is_pinned, created_at, updated_at, _version
- [x] æ›´æ–° `data_transfer.rs` å¯¼å…¥/å¯¼å‡ºæ”¯æŒï¼ˆschema_version å‡è‡³ 2ï¼‰

#### 6.2 åç«¯ Rust
- [x] `app/comment.rs`ï¼šCommentDtoã€CommentCreateReqã€CommentUpdateReqã€4 ä¸ª use case
- [x] `commands/comment.rs`ï¼š4 ä¸ª Tauri å‘½ä»¤ï¼ˆcreate/update/delete/listï¼‰
- [x] æ³¨å†Œå‘½ä»¤åˆ° `lib.rs`
- [x] é›†æˆæµ‹è¯•ï¼ˆ`test_comment.rs`ï¼Œ20+ æµ‹è¯•ç”¨ä¾‹ï¼‰

#### 6.3 å‰ç«¯ä¾èµ–
- [x] å®‰è£… Tiptap ç³»åˆ—åŒ…ï¼š`@tiptap/react`ã€`@tiptap/starter-kit`ã€`@tiptap/extension-*`ï¼ˆlink/image/table/task-listï¼‰
- [x] å®‰è£… `@mantine/tiptap@^7`ï¼ˆå…¼å®¹ Mantine 7.xï¼‰

#### 6.4 å‰ç«¯ç»„ä»¶
- [x] `src/api/comments.ts`ï¼štyped invoke wrapperï¼ˆ4 ä¸ªæ–¹æ³•ï¼‰
- [x] `src/components/RichTextEditor.tsx`ï¼šTiptap å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å°è£…
  - æ‰©å±•ï¼šStarterKitã€Linkã€Imageï¼ˆBase64ï¼‰ã€TaskList/TaskItemã€Table ç³»åˆ—
  - å·¥å…·æ ï¼šç²—ä½“/æ–œä½“ã€æ ‡é¢˜ã€åˆ—è¡¨ã€ä»»åŠ¡æ¸…å•ã€é“¾æ¥ã€å›¾ç‰‡ä¸Šä¼ ã€è¡¨æ ¼æ’å…¥
  - å¯ç¼–è¾‘/åªè¯»æ¨¡å¼åˆ‡æ¢
- [x] `src/components/ProjectComments.tsx`ï¼šè¯„è®ºåŒºç»„ä»¶
  - æ–°å¢è¯„è®ºè¡¨å•ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ + æ“ä½œäººä¸‹æ‹‰ + æäº¤æŒ‰é’®ï¼‰
  - è¯„è®ºåˆ—è¡¨ï¼ˆç½®é¡¶ä¼˜å…ˆ + æ—¶é—´å€’åºï¼‰
  - æ¯æ¡è¯„è®ºå¡ç‰‡ï¼šæ“ä½œäººå¾½ç« ã€æ—¶é—´ã€ç½®é¡¶æ ‡è®°ã€ç¼–è¾‘æ—¶é—´æ ‡æ³¨
  - æ“ä½œæŒ‰é’®ï¼šç¼–è¾‘ï¼ˆinline ç¼–è¾‘ï¼‰ã€åˆ é™¤ï¼ˆç¡®è®¤å¼¹çª—ï¼‰ã€ç½®é¡¶/å–æ¶ˆç½®é¡¶
- [x] `ProjectDetail.tsx` é›†æˆ `<ProjectComments projectId={id} />`ï¼ˆçŠ¶æ€æ—¶é—´çº¿ä¹‹åï¼‰

#### 6.5 i18n
- [x] `en.json` / `zh.json` æ·»åŠ  `comment.*` ç³»åˆ— keyï¼ˆçº¦ 20 ä¸ªï¼‰
  - title/add/edit/delete/pin/unpin/pinned/confirmDelete/noComments/placeholder
  - selectPerson/emptyContent/savedSuccess/saveFailed/deletedSuccess/deleteFailed/loadFailed
  - pinSuccess/unpinSuccess/edited/insertImage/insertTable/table

#### 6.6 æ–‡æ¡£æ›´æ–°
- [x] `AGENTS.md`ï¼šæŠ€æœ¯æ ˆã€ç›®å½•ç»“æ„ã€è¿ç§»åˆ—è¡¨ã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€æ–°å¢ã€Œå¯Œæ–‡æœ¬è¯„è®ºã€ç« èŠ‚
- [x] `PRD.md`ï¼š2.3 å·²å®ç°æ‰©å±•åŠŸèƒ½ + å¯Œæ–‡æœ¬è¯„è®ºæ¡ç›®
- [x] `MILESTONES.md`ï¼šæ–°å¢ M6 é‡Œç¨‹ç¢‘ + ä¾èµ–å…³ç³»å›¾

#### 6.7 éªŒæ”¶
- [x] åç«¯ Rust ç¼–è¯‘é€šè¿‡ï¼Œé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [x] å‰ç«¯ä¾èµ–å®‰è£…æˆåŠŸï¼ˆä½¿ç”¨ `--legacy-peer-deps` å…¼å®¹ Mantine 7.xï¼‰
- [x] é¡¹ç›®è¯¦æƒ…é¡µå¯åˆ›å»ºå¯Œæ–‡æœ¬è¯„è®ºï¼ˆæ–‡æœ¬æ ¼å¼ã€åˆ—è¡¨ã€ä»»åŠ¡æ¸…å•ã€å›¾ç‰‡ã€è¡¨æ ¼ï¼‰
- [x] å¯ç¼–è¾‘ã€åˆ é™¤ã€ç½®é¡¶è¯„è®º
- [x] å¯å…³è”æ“ä½œäººåˆ°è¯„è®º
- [x] ç½®é¡¶è¯„è®ºæ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨
- [x] ä¸­è‹±æ–‡åŒè¯­ç•Œé¢æ­£å¸¸æ˜¾ç¤º

---

## M7ï¼šåŒæ­¥å¢å¼ºï¼ˆVNextï¼‰ğŸš§ è§„åˆ’ä¸­

**ç›®æ ‡**ï¼šåœ¨å·²å®ŒæˆåŒæ­¥é—­ç¯åŸºç¡€ä¸Šï¼Œç»§ç»­æå‡å®‰å…¨æ€§ã€å¯é æ€§ã€å¯è§‚æµ‹æ€§ä¸æ€§èƒ½ã€‚

### è¯¦ç»†éœ€æ±‚å†…å®¹

#### 7.1 å®‰å…¨å¢å¼ºï¼ˆP1ï¼‰
- [ ] å¯é€‰ E2E åŠ å¯†ï¼ˆå¯¹è±¡ä½“åŠ å¯† + æœ¬åœ°å¯†é’¥ç®¡ç†ï¼‰
- [ ] å‡­æ®æ²»ç†å¢å¼ºï¼ˆæœ€å°æš´éœ²é¢ã€è½®æ¢ç­–ç•¥ï¼‰
- [ ] åŒæ­¥ç›¸å…³é”™è¯¯ç ä¸å®‰å…¨å‘Šè­¦åˆ†çº§

#### 7.2 å¯é æ€§å¢å¼ºï¼ˆP2ï¼‰
- [ ] å¿«ç…§é€‰æ‹©é€»è¾‘æ˜¾å¼æ’åºï¼ˆé¿å…ä¾èµ–å¯¹è±¡åˆ—è¡¨é¡ºåºï¼‰
- [ ] Delta key å”¯ä¸€æ€§å¢å¼ºï¼ˆé¿å…åŒç§’å¹¶å‘å¯¹è±¡åå†²çªï¼‰
- [ ] æ›´ç»†ç²’åº¦é‡è¯•/é€€é¿ç­–ç•¥ï¼ˆæŒ‰ä¸Šä¼ /ä¸‹è½½/åº”ç”¨åˆ†é˜¶æ®µï¼‰

#### 7.3 å¯è§‚æµ‹æ€§å¢å¼ºï¼ˆP3ï¼‰
- [ ] å¢åŠ åŒæ­¥æŒ‡æ ‡ï¼šupload/download/apply è€—æ—¶ã€å¤±è´¥ç‡ã€å›æµå‘½ä¸­ç‡
- [ ] å¢åŠ ç»“æ„åŒ–æ—¥å¿—å­—æ®µï¼š`device_id`ã€`delta_key`ã€`cursor_ts`ã€`error_code`
- [ ] å‰ç«¯çŠ¶æ€æ å¢åŠ â€œæœ€è¿‘å¤±è´¥é˜¶æ®µâ€å¯è§†åŒ–

#### 7.4 æ€§èƒ½ä¼˜åŒ–ï¼ˆP4ï¼‰
- [ ] å¤§æ¡¶ä¸‹å¢é‡æ‰«æä¼˜åŒ–ï¼ˆåˆ†é¡µ list / å‰ç¼€åˆ†ç‰‡ï¼‰
- [ ] å¤§ Delta åº”ç”¨ä¼˜åŒ–ï¼ˆåˆ†æ‰¹äº‹åŠ¡æˆ–æ‰¹å¤„ç†çª—å£ï¼‰
- [ ] å¿«ç…§å‹ç¼©å‚æ•°ä¸å¯¹è±¡å¤§å°æ²»ç†

#### 7.5 éªŒæ”¶
- [ ] åŒæ­¥å¤±è´¥å¯å¿«é€Ÿå®šä½åˆ°é˜¶æ®µï¼ˆé…ç½®/ç½‘ç»œ/æ ¡éªŒ/åº”ç”¨ï¼‰
- [ ] åœ¨å¤šè®¾å¤‡é«˜é¢‘å˜æ›´åœºæ™¯ä¸‹ï¼Œæ•°æ®ä»æœ€ç»ˆä¸€è‡´ä¸”æ— æ˜æ˜¾å›æµé£æš´
- [ ] åœ¨å†å²å¯¹è±¡å¢é•¿åï¼Œå•æ¬¡åŒæ­¥è€—æ—¶ä¿æŒå¯æ¥å—

---

## ä¾èµ–å…³ç³»

```mermaid
flowchart LR
  M1 --> M2 --> M3 --> M4 --> M5 --> M6 --> M7
```

- **M2 ä¾èµ– M1**ï¼šM1 å·²æœ‰å‘½ä»¤ä¸ DBï¼ŒM2 åœ¨æ­¤åŸºç¡€ä¸Šè¡¥å…¨å‘½ä»¤å¹¶åšå®Œæ•´ UI
- **M3 ä¾èµ– M2**ï¼šå®Œæ•´æµç¨‹è·‘é€šååšå¯¼å‡ºä¸æ‰“åŒ…
- **M4 ä¾èµ– M3**ï¼šæ ¸å¿ƒ MVP ç¨³å®šåæ‰©å±•åŒæ­¥ä¸æ”¹è¿›
- **M5 ä¾èµ– M4**ï¼šç¨³å®šåŠŸèƒ½ååšå‰ç«¯å›½é™…åŒ–
- **M6 ä¾èµ– M5**ï¼šå›½é™…åŒ–å®Œæˆåæ·»åŠ å¯Œæ–‡æœ¬è¯„è®ºåŠŸèƒ½
- **M7 ä¾èµ– M6**ï¼šåœ¨æ—¢æœ‰åŒæ­¥é—­ç¯ä¸Šåšå®‰å…¨ã€å¯é æ€§ä¸æ€§èƒ½å¢å¼º
